<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Asignar Permisos - BOB</title>
    <link rel="stylesheet" th:href="@{/CSS/dashboard.css}"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<button id="menu-toggle" class="menu-toggle">
    <i class="fas fa-bars"></i>
</button>
<div class="app-container" id="app-container">
    <!-- Incluir sidebar (copiar de dashboard.html) -->
    <aside class="sidebar">
        <!-- Mismo sidebar que en dashboard.html -->
        <div class="sidebar-header">
            <img th:src="@{/IMG/imagen-bob.png}" alt="BOB Logo">
            <h1>BOB</h1>
        </div>
        <ul class="nav-links">
            <!-- Copiar mismo menú que dashboard.html -->
            <li><a th:href="@{/redirigir}"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
            <li><a th:href="@{/roles}"><i class="fas fa-user-shield"></i> <span>Gestión de Roles</span></a></li>
            <!-- ... resto del menú ... -->
        </ul>
    </aside>

    <main class="main-content">
        <div class="header">
            <h2>Asignar Permisos</h2>
        </div>

        <div class="container">
            <h3>Asignar Permisos a: <span th:text="${rol.nombreRol}" class="text-primary"></span></h3>
            <p class="text-muted" th:text="${rol.descripRol}"></p>

            <form th:action="@{/roles/{id}/permisos(id=${rol.idRol})}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                <!-- Agrupar permisos por categoría -->
                <div class="permisos-categorias">
                    <!-- Permisos de Usuarios -->
                    <div class="categoria card mb-3">
                        <div class="card-header">
                            <h4><i class="fas fa-users"></i> Gestión de Usuarios</h4>
                        </div>
                        <div class="card-body">
                            <div th:each="permiso : ${todosPermisos}"
                                 th:if="${#strings.contains(permiso.nombrePermiso, 'USUARIO')}">
                                <div class="form-check">
                                    <input type="checkbox"
                                           th:id="'permiso_' + ${permiso.idPermiso}"
                                           th:name="permisosIds"
                                           th:value="${permiso.idPermiso}"
                                           class="form-check-input"
                                           th:checked="${rol.permisoList != null and rol.permisoList.contains(permiso)}">
                                    <label th:for="'permiso_' + ${permiso.idPermiso}"
                                           class="form-check-label">
                                        <strong th:text="${permiso.nombrePermiso}"></strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Permisos de Roles -->
                    <div class="categoria card mb-3">
                        <div class="card-header">
                            <h4><i class="fas fa-user-shield"></i> Gestión de Roles</h4>
                        </div>
                        <div class="card-body">
                            <div th:each="permiso : ${todosPermisos}"
                                 th:if="${#strings.contains(permiso.nombrePermiso, 'ROL')}">
                                <div class="form-check">
                                    <input type="checkbox"
                                           th:id="'permiso_' + ${permiso.idPermiso}"
                                           th:name="permisosIds"
                                           th:value="${permiso.idPermiso}"
                                           class="form-check-input"
                                           th:checked="${rol.permisoList != null and rol.permisoList.contains(permiso)}">
                                    <label th:for="'permiso_' + ${permiso.idPermiso}"
                                           class="form-check-label">
                                        <strong th:text="${permiso.nombrePermiso}"></strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Permisos de Obras -->
                    <div class="categoria card mb-3">
                        <div class="card-header">
                            <h4><i class="fas fa-building"></i> Gestión de Obras</h4>
                        </div>
                        <div class="card-body">
                            <div th:each="permiso : ${todosPermisos}"
                                 th:if="${#strings.contains(permiso.nombrePermiso, 'OBRA')}">
                                <div class="form-check">
                                    <input type="checkbox"
                                           th:id="'permiso_' + ${permiso.idPermiso}"
                                           th:name="permisosIds"
                                           th:value="${permiso.idPermiso}"
                                           class="form-check-input"
                                           th:checked="${rol.permisoList != null and rol.permisoList.contains(permiso)}">
                                    <label th:for="'permiso_' + ${permiso.idPermiso}"
                                           class="form-check-label">
                                        <strong th:text="${permiso.nombrePermiso}"></strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Permisos de APUs -->
                    <div class="categoria card mb-3">
                        <div class="card-header">
                            <h4><i class="fas fa-calculator"></i> Gestión de APUs</h4>
                        </div>
                        <div class="card-body">
                            <div th:each="permiso : ${todosPermisos}"
                                 th:if="${#strings.contains(permiso.nombrePermiso, 'APU')}">
                                <div class="form-check">
                                    <input type="checkbox"
                                           th:id="'permiso_' + ${permiso.idPermiso}"
                                           th:name="permisosIds"
                                           th:value="${permiso.idPermiso}"
                                           class="form-check-input"
                                           th:checked="${rol.permisoList != null and rol.permisoList.contains(permiso)}">
                                    <label th:for="'permiso_' + ${permiso.idPermiso}"
                                           class="form-check-label">
                                        <strong th:text="${permiso.nombrePermiso}"></strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Más categorías según sea necesario -->
                </div>

                <!-- Botones -->
                <div class="mt-4">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar Permisos
                    </button>
                    <a th:href="@{/roles}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Volver a Roles
                    </a>
                </div>
            </form>
        </div>
    </main>
</div>

<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        // Lógica del menú móvil (igual que en dashboard)
        const toggleButton = document.getElementById('menu-toggle');
        const appContainer = document.getElementById('app-container');

        if (toggleButton && appContainer) {
            toggleButton.addEventListener('click', function() {
                appContainer.classList.toggle('sidebar-active');
            });
        }
    });
</script>
</body>
</html>